<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
	<title>Эмулятор устройств</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

	<script type="text/javascript" src="/javascripts/jquery.min.js"></script>
</head>
<body>
	<div id='Main'>
		<h1>Управление устройствами</h1>
		<ul class='DashBoard'>
			<li><a class="Reset" href="">Сбросить</a></li>
		</ul>

		<!-- Входная дверь -->
		<div class='Device'>
			<label for="inpEntranceDoor" class="Label1">Входная дверь</label>
			<input type="text" name="_entrance_door" value="" id="inpEntranceDoor" class="Input1" disabled/>
			<ul class='EntranceDoor'>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Таймер -->
		<div class='Device'>
			<label for="inpTimer" class="Label1">Таймер</label>
			<input type="text" name="_timer" value="" id="inpTimer" class="Input1" disabled/>
			<input type="text" name="_timer_state" value="" id="inpTimerState" class="Input1" disabled/>
			
			<ul class='Timer'>
				<li><a class="Set">Включить</a></li>
				<li><a class="Stop">Выключить</a></li>
			</ul>
		</div>

		<!-- Дверь в команту №2 -->
		<div class='Device'>
			<label for="inpRoom2Door" class="Label1">Дверь в команту №2</label>
			<input type="text" name="_room2_door" value="" id="inpRoom2Door" class="Input1" disabled/>
			<ul class='Room2Door'>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Кнопка, открывающая шкаф -->
		<div class='Device'>
			<label for="inpLockerButton" class="Label1">Кнопка, открывающая шкаф</label>
			<ul class='LockerButton'>
				<li><a class="Push" href="">Нажать</a></li>
			</ul>
		</div>

		<!-- Дверь шкафа -->
		<div class='Device'>
			<label for="inpLockerDoor" class="Label1">Дверь шкафа</label>
			<input type="text" name="_locker_door" value="" id="inpLockerDoor" class="Input1" disabled/>
			<ul class='LockerDoor'>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Подставка многогранника -->
		<div class='Device'>
			<label for="inpPolyhedronRack" class="Label1">Подставка многогранника</label>
			<input type="text" name="_polyhedron_rack" value="" id="inpPolyhedronRack" class="Input1" disabled/>
			<ul class='PolyhedronRack'>
				<li><a class="On" href="">Активировать</a></li>
				<li><a class="Off" href="">Деактивировать</a></li>
			</ul>
		</div>

		<!-- Свет -->
		<div class='Device'>
			<label for="inpLight" class="Label1">Свет</label>
			<input type="text" name="_light" value="" id="inpLight" class="Input1" disabled/>
			<ul class='Light'>
				<li><a class="On" href="">Включить</a></li>
				<li><a class="Off" href="">Выключить</a></li>
			</ul>
		</div>

		<!-- Дверь в команту №3 -->
		<div class='Device'>
			<label for="inpRoom3Door" class="Label1">Дверь в команту №3</label>
			<input type="text" name="_room3_door" value="" id="inpRoom3Door" class="Input1" disabled/>
			<ul class='Room3Door'>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Дверь в команту №4 -->
		<div class='Device'>
			<label for="inpRoom4Door" class="Label1">Дверь в команту №4</label>
			<input type="text" name="_room4_door" value="" id="inpRoom4Door" class="Input1" disabled/>
			<ul class='Room4Door'>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Дверь в команту №5 -->
		<div class='Device'>
			<label for="inpRoom5Door" class="Label1">Дверь в команту №5</label>
			<input type="text" name="_room5_door" value="" id="inpRoom5Door" class="Input1" disabled/>
			<ul class='Room5Door'>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Кнопка, спасения игрока -->
		<div class='Device'>
			<label for="inpSaveButton" class="Label1">Кнопка, спасения предпоследнего игрока</label>
			<ul class='SaveButton'>
				<li><a class="Push" href="">Нажать</a></li>
			</ul>
		</div>

		<!-- Дверь в команту №6 -->
		<div class='Device'>
			<label for="inpRoom6Door" class="Label1">Дверь в команту №6</label>
			<input type="text" name="_room6_door" value="" id="inpRoom6Door" class="Input1" disabled/>
			<ul class='Room6Door'>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Ячейка №1 -->
		<div class='Device'>
			<label for="inpCell1" class="Label1">Ячейка №1</label>
			<input type="text" name="_cell1" value="" id="inpCell1" class="Input1" />
			<input type="text" name="_cell1_state" value="" id="inpCell1State" class="Input1" disabled/>

			<ul class='Cell1'>
				<li><a class="Send" href="">Отправить код</a></li>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Ячейка №2 -->
		<div class='Device'>
			<label for="inpCell2" class="Label1">Ячейка №2</label>
			<input type="text" name="_cell2" value="" id="inpCell2" class="Input1" />
			<input type="text" name="_cell2_state" value="" id="inpCell2State" class="Input1" disabled/>

			<ul class='Cell2'>
				<li><a class="Send" href="">Отправить код</a></li>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

		<!-- Дверь в команту №7 -->
		<div class='Device'>
			<label for="inpRoom7Door" class="Label1">Дверь в команту №7</label>
			<input type="text" name="_room7_door" value="" id="inpRoom7Door" class="Input1" disabled/>
			<ul class='Room7Door'>
				<li><a class="Open">Открыть</a></li>
				<li><a class="Close">Закрыть</a></li>
			</ul>
		</div>

	</div>

	<script type="text/javascript">
		var host_url         = "http://localhost:3030";
		var web_server_url   = "http://localhost:3000";

		$(document).ready(function() {

			// проверяем состояние устройств
			// в данном случае - читаем коллекцию devices из mongo
			setInterval(function(){
				$.ajax({
				url: host_url + '/devices_list/all',
				type: "GET",
				crossDomain: true,
				dataType: "json",
					success: function (response) {
						console.log('Devices state');

						// входная дверь
						if (response._entrance_door.state == "opened") {
							$("#inpEntranceDoor").val('Открыта');
						} else if (response._entrance_door.state == "closed") {
							$("#inpEntranceDoor").val('Закрыта');
						}

						// таймер
						$("#inpTimer").val(response._timer.current_value.toString());
						if (response._timer.state == "active") {
							$("#inpTimerState").val('Активен');
						} else if (response._timer.state == "ready") {
							$("#inpTimerState").val('Готов');
						} else if (response._timer.state == "idle") {
							$("#inpTimerState").val('Неактивен');
						}

						// дверь в комнату №2 
						if (response._room2_door.state == "opened") {
							$("#inpRoom2Door").val('Открыта');
						} else if (response._room2_door.state == "closed") {
							$("#inpRoom2Door").val('Закрыта');
						}

						// кнопка, открывающая шкаф

						// дверь шкафа
						if (response._locker_door.state == "opened") {
							$("#inpLockerDoor").val('Открыта');
						} else if (response._locker_door.state == "closed") {
							$("#inpLockerDoor").val('Закрыта');
						}

						// подставка многогранника
						if (response._polyhedron_rack.state == "active") {
							$("#inpPolyhedronRack").val('Активна');
						} else if (response._polyhedron_rack.state == "idle") {
							$("#inpPolyhedronRack").val('Не активна');
						}

						// свет
						if (response._light.state == "on") {
							$("#inpLight").val('Включён');
						} else if (response._light.state == "off") {
							$("#inpLight").val('Выключен');
						}

						// дверь в комнату №3
						if (response._room3_door.state == "opened") {
							$("#inpRoom3Door").val('Открыта');
						} else if (response._room3_door.state == "closed") {
							$("#inpRoom3Door").val('Закрыта');
						}

						// дверь в комнату №4
						if (response._room4_door.state == "opened") {
							$("#inpRoom4Door").val('Открыта');
						} else if (response._room4_door.state == "closed") {
							$("#inpRoom4Door").val('Закрыта');
						}

						// дверь в комнату №5
						if (response._room5_door.state == "opened") {
							$("#inpRoom5Door").val('Открыта');
						} else if (response._room5_door.state == "closed") {
							$("#inpRoom5Door").val('Закрыта');
						}

						// дверь в комнату №6
						if (response._room6_door.state == "opened") {
							$("#inpRoom6Door").val('Открыта');
						} else if (response._room6_door.state == "closed") {
							$("#inpRoom6Door").val('Закрыта');
						}

						// дверь в комнату №7
						if (response._room7_door.state == "opened") {
							$("#inpRoom7Door").val('Открыта');
						} else if (response._room7_door.state == "closed") {
							$("#inpRoom7Door").val('Закрыта');
						}

					},
					error: function(error) {
						console.log('ERROR:', error);
					}
				});
			}, 500);	
		});

		// Инициализация устройств
		// в данном случае - удаляем и инициализируем коллекцию devices mongo
		$('#Main .DashBoard .Reset').click(function(e){
			$.ajax({
				url: host_url + '/devices_list/reset',
				type: "GET",
				crossDomain: true,
				dataType: "json",
					success: function (response) {
						console.log('Devices reset');
					},
					error: function(error) {
						console.log('ERROR:', error);
					}
			});
		});

		// Кнопка 'Нажать' - для моделирования нажатия кнопки шкафа
		$('#Main .LockerButton .Push').click(function(e){
			if ($("#inpRoom2Door").val() == 'Открыта') {
				$.ajax({
					url: host_url + '/locker_button/pushed',
					type: "GET",
					crossDomain: true,
					dataType: "json",
						success: function (response) {
							console.log('button pushed');
						},
						error: function(error) {
							console.log('ERROR:', error);
						}
				});
			}
		});

		// Кнопка 'Нажать' - для моделирования нажатия кнопки спасения
		$('#Main .SaveButton .Push').click(function(e){
			//if ($("#inpRoom2Door").val() == 'Открыта') {
				$.ajax({
					url: host_url + '/save_button/push',
					type: "GET",
					crossDomain: true,
					dataType: "json",
						success: function (response) {
							console.log('button pushed');
						},
						error: function(error) {
							console.log('ERROR:', error);
						}
				});
			//}
		});

		// Кнопка 'Отправить' - для отправки значения ячейки
		$('#Main .Cell1 .Send').click(function(e){
			//if ($("#inpRoom2Door").val() == 'Открыта') {
				$.ajax({
					url: host_url + '/cell1/enter/' + $("#inpCell1").val(),
					type: "GET",
					crossDomain: true,
					dataType: "json",
						success: function (response) {
							console.log('cell enter');
						},
						error: function(error) {
							console.log('ERROR:', error);
						}
				});
			//}
		});

		// Кнопка 'Отправить' - для отправки значения ячейки
		$('#Main .Cell2 .Send').click(function(e){
			//if ($("#inpRoom2Door").val() == 'Открыта') {
				$.ajax({
					url: host_url + '/cell2/enter/' + $("#inpCell2").val(),
					type: "GET",
					crossDomain: true,
					dataType: "json",
						success: function (response) {
							console.log('cell enter');
						},
						error: function(error) {
							console.log('ERROR:', error);
						}
				});
			//}
		});

		// Кнопки 'Активировать' и 'Деактивировать' - для моделирования подставки
		$('#Main .PolyhedronRack .On').click(function(e){
			if ($("#inpLockerDoor").val() == 'Открыта') {
				$.ajax({
					url: host_url + '/polyhedron_rack/activated',
					type: "GET",
					crossDomain: true,
					dataType: "json",
						success: function (response) {
							console.log('rack activated');
						},
						error: function(error) {
							console.log('ERROR:', error);
						}
				});
			}
		});
		$('#Main .PolyhedronRack .Off').click(function(e){
			if ($("#inpLockerDoor").val() == 'Открыта') {
				$.ajax({
					url: host_url + '/polyhedron_rack/deactivated',
					type: "GET",
					crossDomain: true,
					dataType: "json",
						success: function (response) {
							console.log('rack deactivated');
						},
						error: function(error) {
							console.log('ERROR:', error);
						}
				});
			}
		});

	</script>
</body>
</html>